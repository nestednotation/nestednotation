html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    script(src='https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js')
    script(src='/javascripts/audio-player.js')
    script(src='/javascripts/nosleep.js')

    meta( name='viewport', content='width=device-width, initial-scale=1.0' )

    link(rel='apple-touch-icon', sizes="180x180", href="/icon/apple-touch-icon.png")
    link(rel="icon", type="image/png", sizes="32x32", href="/icon/favicon-32x32.png")
    link(rel="icon", type="image/png", sizes="16x16", href="/icon/favicon-16x16.png")
    link(rel="manifest", href="/icon/site.webmanifest")
    link(rel="mask-icon", href="/icon/safari-pinned-tab.svg", color="#5bbad5")
    meta(name="msapplication-TileColor", content="#da532c")
    meta(name="theme-color", content="#ffffff")
    
  body(class="play-mode")
    script.
      var soundList= JSON.parse('!{soundList}');
      var scoreSlug = '#{scoreSlug}';
      var staffCode = '#{staffCode}';
      var sessionId = '#{sessionId}';
      var hostAddress = '#{hostAddress}';
      var wsPort = '#{webSocketPort}';
      var wsPath = '#{wsPath}'

      var isHtml5 = JSON.parse('!{isHtml5}');
      var fadeDuration = JSON.parse('!{fadeDuration}')

      var CONST_NO_SLEEP_DURATION = #{noSleepDuration};
      var MSG_PING = #{msgPing};
      var MSG_TAP = #{msgTap};
      var MSG_SHOW = #{msgShow};
      var MSG_NEED_DISPLAY = #{msgNeedDisplay};
      var MSG_UPDATE_VOTING = #{msgUpdateVoting};
      var MSG_BEGIN_VOTING = #{msgBeginVoting};
      var MSG_BEGIN_STANDBY = #{msgBeginStandby};
      var MSG_CHECK_HOLD = #{msgCheckHold};
      var MSG_BEGIN_HOLDING = #{msgBeginHolding};
      var MSG_FINISH = #{msgFinish};
      var MSG_PAUSE = #{msgPause};
      var MSG_SELECT_HISTORY = #{msgSelectHistory};
      var MSG_SHOW_NUMBER_CONNECTION = #{msgShowNumberConnection};

    script(src='/javascripts/session.js')

    svg(id="filter-source", xmlns="http://www.w3.org/2000/svg", version="1.1", viewBox="0 0 1 1", width="0", height="0", style="display: block !important; height: 0;")
      defs
        filter(id="grayscale")
          feColorMatrix(type="saturate", values="0")
          
    div(class="control-container")
      div(class="session-control-container")
        div(id="divhold", style="display: none;")
          input(type="checkbox", id="hold", onclick="sendHold(this);", checked="true")
          label(for="hold") &nbsp;hold
        div(id="divpause", style="display: none;")
          input(type="checkbox", id="pause", onclick="sendPause(this);", checked="true")
          label(for="pause") &nbsp;pause
        div(id="divhistory", style="display: none;")
          select(id="history", onchange="sendHistory(this);")
      div(class="user-control-container")
        div(class="count-down-container")
          div(id="circle_10", class="circle")
          div(id="circle_9", class="circle")
          div(id="circle_8", class="circle")
          div(id="circle_7", class="circle")
          div(id="circle_6", class="circle")
          div(id="circle_5", class="circle")
          div(id="circle_4", class="circle")
          div(id="circle_3", class="circle")
          div(id="circle_2", class="circle")
          div(id="circle_1", class="circle")
        img(id="cooldown-icon",src="/svg/cooldown-icon.svg")
        img(id="hold-icon", src="/svg/hold-icon.svg")
        button(id="side-menu-trigger", class="side-menu-trigger", onclick="toggleSideMenu(event)", type="button", title="open side menu") 
          img(src="/svg/side-menu-icon.svg", style="pointer-events: none;")

    div(style="clear: both;")
    
    div(id="MainContent", style="width:100%; height:90%; position: relative;")
      div(id="divOverlay" style="width: 100%; height: 100%; position: absolute; background-color: white; opacity: 0.50; display: none;")
      div(id="MainSVGContent")
        | !{svg}
        | !{audio}
      svg(id="svg-1", width="100%", height="100%", viewBox="0 0 1801 1801", version="1.1", xmlns="http://www.w3.org/2000/svg", xmlns:xlink="http://www.w3.org/1999/xlink", xml:space="preserve", xmlns:serif="http://www.serif.com/", style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;")
        g
          rect(x="0.7", y="0.9", width="1800", height="1800", style="fill:none;")
          rect(x="157.853", y="157.468", width="1501.06", height="1501.09", style="fill:white;")
          g(transform="matrix(1,0,0,1,775.668,1048.98)")
            g
              g(transform="matrix(64,0,0,64,0,0)")
                  path(d="M0.129,0.234C0.117,0.234 0.108,0.231 0.101,0.224C0.093,0.217 0.09,0.207 0.09,0.195L0.09,-0.277C0.091,-0.329 0.103,-0.376 0.128,-0.418C0.152,-0.459 0.185,-0.492 0.227,-0.516C0.268,-0.54 0.315,-0.552 0.367,-0.552C0.42,-0.552 0.468,-0.54 0.51,-0.516C0.552,-0.491 0.585,-0.458 0.61,-0.416C0.634,-0.374 0.646,-0.326 0.646,-0.273C0.646,-0.22 0.634,-0.173 0.611,-0.131C0.587,-0.089 0.555,-0.056 0.514,-0.032C0.473,-0.007 0.427,0.005 0.376,0.005C0.331,0.005 0.291,-0.005 0.255,-0.024C0.218,-0.043 0.189,-0.068 0.167,-0.099L0.167,0.195C0.167,0.207 0.164,0.217 0.157,0.224C0.15,0.231 0.14,0.234 0.129,0.234ZM0.367,-0.065C0.406,-0.065 0.44,-0.074 0.471,-0.092C0.502,-0.11 0.526,-0.135 0.544,-0.167C0.561,-0.198 0.57,-0.234 0.57,-0.273C0.57,-0.313 0.561,-0.349 0.544,-0.38C0.526,-0.411 0.502,-0.436 0.471,-0.455C0.44,-0.473 0.406,-0.482 0.367,-0.482C0.329,-0.482 0.295,-0.473 0.264,-0.455C0.233,-0.436 0.209,-0.411 0.192,-0.38C0.175,-0.349 0.166,-0.313 0.166,-0.273C0.166,-0.234 0.175,-0.198 0.192,-0.167C0.209,-0.135 0.233,-0.11 0.264,-0.092C0.295,-0.074 0.329,-0.065 0.367,-0.065Z", style="fill-rule:nonzero;")
              g(transform="matrix(64,0,0,64,45.248,0)")
                  path(d="M0.331,0.005C0.28,0.005 0.234,-0.007 0.193,-0.032C0.152,-0.056 0.12,-0.089 0.097,-0.131C0.073,-0.173 0.061,-0.22 0.061,-0.273C0.061,-0.326 0.073,-0.374 0.098,-0.416C0.122,-0.458 0.155,-0.491 0.197,-0.516C0.239,-0.54 0.286,-0.552 0.339,-0.552C0.392,-0.552 0.439,-0.54 0.481,-0.516C0.522,-0.491 0.555,-0.458 0.58,-0.416C0.604,-0.374 0.616,-0.326 0.617,-0.273L0.586,-0.249C0.586,-0.201 0.575,-0.158 0.553,-0.12C0.53,-0.081 0.5,-0.051 0.462,-0.029C0.423,-0.006 0.38,0.005 0.331,0.005ZM0.339,-0.065C0.378,-0.065 0.412,-0.074 0.443,-0.092C0.473,-0.11 0.497,-0.135 0.515,-0.167C0.532,-0.198 0.541,-0.234 0.541,-0.273C0.541,-0.313 0.532,-0.349 0.515,-0.38C0.497,-0.411 0.473,-0.436 0.443,-0.455C0.412,-0.473 0.378,-0.482 0.339,-0.482C0.301,-0.482 0.267,-0.473 0.236,-0.455C0.205,-0.436 0.181,-0.411 0.163,-0.38C0.145,-0.349 0.136,-0.313 0.136,-0.273C0.136,-0.234 0.145,-0.198 0.163,-0.167C0.181,-0.135 0.205,-0.11 0.236,-0.092C0.267,-0.074 0.301,-0.065 0.339,-0.065ZM0.578,0C0.567,0 0.557,-0.004 0.55,-0.011C0.543,-0.018 0.539,-0.027 0.539,-0.038L0.539,-0.209L0.558,-0.288L0.617,-0.273L0.617,-0.038C0.617,-0.027 0.613,-0.018 0.606,-0.011C0.599,-0.004 0.589,0 0.578,0Z", style="fill-rule:nonzero;")
              g(transform="matrix(64,0,0,64,88.576,0)")
                  path(d="M0.328,0.006C0.281,0.006 0.238,-0.004 0.201,-0.024C0.164,-0.043 0.134,-0.072 0.113,-0.11C0.091,-0.148 0.08,-0.194 0.08,-0.249L0.08,-0.509C0.08,-0.52 0.084,-0.529 0.091,-0.536C0.098,-0.543 0.107,-0.547 0.118,-0.547C0.129,-0.547 0.139,-0.543 0.146,-0.536C0.153,-0.529 0.157,-0.52 0.157,-0.509L0.157,-0.249C0.157,-0.208 0.165,-0.174 0.181,-0.147C0.196,-0.12 0.218,-0.1 0.245,-0.087C0.272,-0.074 0.302,-0.067 0.336,-0.067C0.369,-0.067 0.398,-0.073 0.425,-0.086C0.451,-0.099 0.472,-0.116 0.487,-0.138C0.502,-0.16 0.51,-0.185 0.51,-0.213L0.565,-0.213C0.563,-0.171 0.552,-0.133 0.531,-0.101C0.509,-0.068 0.481,-0.042 0.446,-0.023C0.411,-0.003 0.371,0.006 0.328,0.006ZM0.548,0C0.537,0 0.528,-0.004 0.521,-0.011C0.514,-0.018 0.51,-0.027 0.51,-0.039L0.51,-0.509C0.51,-0.52 0.514,-0.53 0.521,-0.537C0.528,-0.544 0.537,-0.547 0.548,-0.547C0.559,-0.547 0.569,-0.544 0.576,-0.537C0.583,-0.53 0.587,-0.52 0.587,-0.509L0.587,-0.039C0.587,-0.027 0.583,-0.018 0.576,-0.011C0.569,-0.004 0.559,0 0.548,0Z", style="fill-rule:nonzero;")
              g(transform="matrix(64,0,0,64,131.904,0)")
                  path(d="M0.281,0.005C0.242,0.005 0.203,-0.002 0.164,-0.015C0.125,-0.028 0.094,-0.048 0.07,-0.075C0.063,-0.083 0.06,-0.092 0.061,-0.102C0.062,-0.112 0.067,-0.121 0.076,-0.128C0.085,-0.135 0.095,-0.137 0.105,-0.136C0.115,-0.135 0.123,-0.13 0.13,-0.123C0.146,-0.104 0.167,-0.09 0.194,-0.08C0.22,-0.07 0.249,-0.065 0.281,-0.065C0.33,-0.065 0.366,-0.074 0.388,-0.091C0.41,-0.108 0.421,-0.128 0.422,-0.152C0.422,-0.176 0.411,-0.196 0.388,-0.212C0.365,-0.227 0.328,-0.239 0.276,-0.248C0.209,-0.259 0.159,-0.277 0.128,-0.304C0.097,-0.331 0.081,-0.362 0.081,-0.399C0.081,-0.433 0.09,-0.461 0.108,-0.484C0.126,-0.507 0.15,-0.524 0.18,-0.535C0.21,-0.546 0.243,-0.552 0.279,-0.552C0.324,-0.552 0.362,-0.544 0.395,-0.529C0.427,-0.514 0.453,-0.493 0.473,-0.467C0.48,-0.458 0.482,-0.449 0.481,-0.44C0.48,-0.431 0.474,-0.423 0.465,-0.417C0.457,-0.412 0.448,-0.411 0.438,-0.413C0.427,-0.414 0.418,-0.419 0.411,-0.427C0.394,-0.446 0.375,-0.46 0.353,-0.47C0.331,-0.478 0.306,-0.483 0.277,-0.483C0.24,-0.483 0.211,-0.475 0.189,-0.461C0.167,-0.446 0.156,-0.427 0.156,-0.404C0.156,-0.389 0.16,-0.375 0.169,-0.364C0.177,-0.353 0.191,-0.343 0.212,-0.334C0.232,-0.325 0.26,-0.318 0.297,-0.312C0.347,-0.304 0.387,-0.292 0.416,-0.277C0.445,-0.261 0.465,-0.243 0.478,-0.222C0.49,-0.201 0.496,-0.178 0.496,-0.153C0.496,-0.122 0.487,-0.094 0.469,-0.071C0.45,-0.047 0.425,-0.028 0.393,-0.015C0.36,-0.002 0.323,0.005 0.281,0.005Z", style="fill-rule:nonzero;")
              g(transform="matrix(64,0,0,64,166.4,0)")
                  path(d="M0.338,0.005C0.284,0.005 0.236,-0.007 0.195,-0.031C0.153,-0.054 0.12,-0.087 0.097,-0.129C0.073,-0.171 0.061,-0.219 0.061,-0.273C0.061,-0.328 0.072,-0.376 0.095,-0.418C0.117,-0.459 0.148,-0.492 0.187,-0.516C0.226,-0.54 0.272,-0.552 0.323,-0.552C0.374,-0.552 0.418,-0.541 0.456,-0.518C0.493,-0.494 0.522,-0.463 0.543,-0.422C0.564,-0.381 0.574,-0.335 0.574,-0.283C0.574,-0.272 0.571,-0.264 0.564,-0.258C0.557,-0.251 0.549,-0.248 0.538,-0.248L0.113,-0.248L0.113,-0.312L0.546,-0.312L0.503,-0.281C0.504,-0.32 0.497,-0.354 0.482,-0.385C0.467,-0.416 0.447,-0.44 0.42,-0.457C0.393,-0.474 0.36,-0.483 0.323,-0.483C0.285,-0.483 0.252,-0.474 0.223,-0.456C0.194,-0.438 0.172,-0.413 0.157,-0.382C0.141,-0.35 0.133,-0.314 0.133,-0.273C0.133,-0.232 0.142,-0.196 0.16,-0.165C0.177,-0.134 0.201,-0.109 0.232,-0.091C0.263,-0.073 0.298,-0.064 0.338,-0.064C0.362,-0.064 0.386,-0.068 0.411,-0.077C0.435,-0.085 0.454,-0.095 0.469,-0.108C0.476,-0.114 0.485,-0.117 0.494,-0.118C0.503,-0.118 0.511,-0.115 0.518,-0.11C0.527,-0.102 0.531,-0.093 0.532,-0.084C0.532,-0.075 0.528,-0.067 0.52,-0.06C0.498,-0.041 0.47,-0.026 0.436,-0.014C0.402,-0.001 0.369,0.005 0.338,0.005Z", style="fill-rule:nonzero;")
              g(transform="matrix(64,0,0,64,204.416,0)")
                  path(d="M0.339,0.005C0.286,0.005 0.239,-0.007 0.197,-0.032C0.155,-0.056 0.122,-0.089 0.098,-0.131C0.073,-0.173 0.061,-0.221 0.061,-0.274C0.061,-0.327 0.073,-0.374 0.097,-0.416C0.12,-0.458 0.152,-0.491 0.193,-0.516C0.234,-0.54 0.28,-0.552 0.331,-0.552C0.376,-0.552 0.416,-0.543 0.452,-0.524C0.488,-0.505 0.517,-0.479 0.539,-0.448L0.539,-0.742C0.539,-0.754 0.543,-0.763 0.55,-0.771C0.557,-0.778 0.567,-0.781 0.578,-0.781C0.589,-0.781 0.599,-0.778 0.606,-0.771C0.613,-0.763 0.617,-0.754 0.617,-0.742L0.617,-0.27C0.616,-0.218 0.603,-0.171 0.579,-0.13C0.554,-0.088 0.521,-0.055 0.48,-0.031C0.438,-0.007 0.391,0.005 0.339,0.005ZM0.339,-0.065C0.378,-0.065 0.412,-0.074 0.443,-0.093C0.473,-0.111 0.497,-0.136 0.515,-0.167C0.532,-0.198 0.541,-0.234 0.541,-0.274C0.541,-0.313 0.532,-0.349 0.515,-0.381C0.497,-0.412 0.473,-0.437 0.443,-0.455C0.412,-0.473 0.378,-0.482 0.339,-0.482C0.301,-0.482 0.267,-0.473 0.236,-0.455C0.205,-0.437 0.181,-0.412 0.163,-0.381C0.145,-0.349 0.136,-0.313 0.136,-0.274C0.136,-0.234 0.145,-0.198 0.163,-0.167C0.181,-0.136 0.205,-0.111 0.236,-0.093C0.267,-0.074 0.301,-0.065 0.339,-0.065Z", style="fill-rule:nonzero;")
    div(id="tablefooter", class="session-status-container",  style="display: none;")
      span Player:
      span(id="spanplayer") 0
      span |
      span Rider:
      span(id="spanrider") 0
      span |
      div(id="divfinish", style="display: none;")
        button(type="button", id="finish", onclick="sendFinish(this);") end
      button(type="button",  id="SleepActivate") wake lock
    div(id="loading-sound-indicator")
      | loading audio...
    div(id="change-mode-container", class="change-mode-container", data-mode="PLAY")
      div(class="mode-indicator-container")
        div(class="mode-indicator")
          img(src="/svg/guide-lock-icon.svg")
      button(class="change-mode-btn", type="button", onclick="toggleSessionMode('PLAY')") play
      button(class="change-mode-btn", type="button", onclick="toggleSessionMode('GUIDE')") guide
    div(id="side-menu-container", data-show="false", onclick="toggleSideMenu(event)", class="side-menu-container", style="display: none;")
      div(class="side-menu-title") 
        img(src="/svg/score-title-icon.svg")
        span #{scoreTitle}
        button(class="close-side-menu-btn", onclick="toggleSideMenu(event)", type="button", title="close side menu")
          img(src="/svg/close-icon.svg")
      div(class="side-menu-list")
        ul
          li(onclick="refreshSession()") refresh session
            img(src="/svg/refresh-session-icon.svg")
          li(onclick="toggleAutoplay(this)") autoplay
            div(class="autoplay-toggler")
              div(class="autoplay-toggler-knob")
          li about
            img(src="/svg/refresh-session-icon.svg")



 